DROP TABLES IF EXISTS T_PROXY_ADDR;
CREATE TABLE `T_PROXY_ADDR` (
  `ID` bigint(20) NOT NULL AUTO_INCREMENT,
  `IP` int unsigned NOT NULL COMMENT 'IP地址值',
  `PORT` int NOT NULL COMMENT '端口',
  `ADDR_CODE` varchar(20) NOT NULL DEFAULT '0' COMMENT 'IP-PORT',
  `SOURCE` varchar(100) COMMENT '来源',
  `REGION_NAME` varchar(50) COMMENT '地区名称',
  `ISP_NAME` varchar(50) COMMENT '服务商名称',
  `IS_DELETE` tinyint(4) DEFAULT '0' COMMENT '状态',
  `CREATE_TIME` timestamp NULL DEFAULT NULL COMMENT '创建时间',
  `UPDATE_TIME` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00' ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`ID`),
  KEY INDEX_T_PROXY_ADDR_CODE ( `ADDR_CODE`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT '代理地址表';
ALTER TABLE T_PROXY_ADDR
ADD COLUMN `TYPE` tinyint NOT NULL DEFAULT '0' COMMENT '代理类型,0-未知,1-HTTP代理,2-SOCKET代理',
ADD COLUMN `REMARK` varchar(100) NOT NULL DEFAULT '' COMMENT '备注';

DROP TABLES IF EXISTS T_PROXY_DETECT;
CREATE TABLE `T_PROXY_DETECT` (
  `ID` bigint(20) NOT NULL AUTO_INCREMENT,
  `IP` int unsigned NOT NULL COMMENT 'IP地址值',
  `PORT` int NOT NULL COMMENT '端口',
  `DOMAIN` varchar(50) COMMENT '监测',
  `URL` varchar(1000) COMMENT '监测URL',
  `DETECTOR` varchar(50) COMMENT '监测者',
  `CUR_COST`  int DEFAULT '0' COMMENT '耗时',
  `MIN_COST`  int DEFAULT '0' COMMENT '最短耗时',
  `MAX_COST`  int DEFAULT '0' COMMENT '最长耗时',
  `RETRY_TIMES` int DEFAULT '0' COMMENT '重试次数',
  `STATUS` tinyint(4) DEFAULT '0' COMMENT '状态,-2:禁用，-1:停用，0:重试，1:可用',
  `CREATE_TIME` timestamp NULL DEFAULT NULL COMMENT '创建时间',
  `UPDATE_TIME` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00' ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`ID`),
  KEY `IDX_T_PROXY_DETECT_IP_HOST` (`IP`,`PORT`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT '代理检测表';

ALTER TABLE T_PROXY_DETECT
ADD COLUMN `FAIL_COUNT` int NOT NULL DEFAULT '0' COMMENT '失败数',
ADD COLUMN `SUCCESS_COUNT` int NOT NULL DEFAULT '0' COMMENT '成功数',
ADD COLUMN `LAST_SUCCESS_COUNT` int NOT NULL DEFAULT '0' COMMENT '连续成功数';


ALTER TABLE T_PROXY_DETECT
ADD COLUMN `ADDR_CODE` varchar(20) NOT NULL DEFAULT '0' COMMENT 'IP-PORT' AFTER `ID`,
ADD COLUMN `VERIFY_STATUS` tinyint DEFAULT '0' COMMENT '验证状态,0:未知,1:成功,-1:失败',
ADD COLUMN `REMARK` varchar(100) NOT NULL DEFAULT '' COMMENT '备注';

DROP TABLES IF EXISTS T_PROXY_HOME;
CREATE TABLE `T_PROXY_HOME` (
  `ID` bigint(20) NOT NULL AUTO_INCREMENT,
  `HOME_URL` varchar(200) NOT NULL default '' COMMENT '代理源URL',
  `CONFIG_PARSER` varchar(50) COMMENT '抓取配置',
  `MAX_PAGE` int NOT NULL default '1' COMMENT '最大页数',
  `IS_DELETE` tinyint NOT NULL default '0' COMMENT '0-否，1-是',
  `STATUS` tinyint NOT NULL default '0' COMMENT '0-等待，1-处理中，2-完成',
  `CREATE_TIME` timestamp NULL  COMMENT '创建时间',
  `UPDATE_TIME` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00' ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`ID`),
  KEY `T_PROXY_HOME_HOME_URL` (`HOME_URL`(50))
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT '代理源';

DROP TABLES IF EXISTS T_PROXY_SEED;
CREATE TABLE `T_PROXY_SEED` (
  `ID` bigint(20) NOT NULL AUTO_INCREMENT,
  `URL` varchar(200) NOT NULL default '' COMMENT '代理URL',
  `CREATE_URLS_FUN` text NOT NULL default '' COMMENT '链接生成函数 ',
  `DECODE_PAGE_FUN` text NOT NULL default '' COMMENT '页面解码函数',
  `CREATE_TIME` timestamp NULL  COMMENT '创建时间',
  `UPDATE_TIME` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00' ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT '代理种子';

DROP TABLES IF EXISTS T_PROXY_COLLECT_HIS;
CREATE TABLE `T_PROXY_COLLECT_HIS` (
  `ID` bigint(20) NOT NULL AUTO_INCREMENT,
  `SEED_ID` bigint(20) NOT NULL DEFAULT '0' COMMENT '代理源ID',
  `TOTAL_PAGE` int DEFAULT '0' COMMENT '链接生成函数 ',
  `FETCH_PAGE` int DEFAULT '0' COMMENT '页面解码函数',
  `TOTAL_COUNT` int DEFAULT '0' COMMENT '总代理数',
  `NEW_COUNT` int DEFAULT '0' COMMENT '新代理数',
  `CREATE_TIME` timestamp NULL  COMMENT '创建时间',
  `UPDATE_TIME` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00' ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`ID`),
  KEY `T_PROXY_COLLECT_HIS_SEED_ID` (`SEED_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT '代理收集历史';

ALTER TABLE T_PROXY_ADDR
ADD COLUMN  `SEED_ID` bigint(20) NOT NULL DEFAULT '0' COMMENT '代理源ID';